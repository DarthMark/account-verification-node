<!DOCTYPE html><html><head><title>Account Verification</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Account Verification"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Account Verification</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement account verification in your web app with Twilio-powered Authy. Account verification helps you ensure your customer data is accurate and secure. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Register a User" class="chapter"><div data-title="Introduction" class="step"><h2 id="introduction">Introduction</h2>
<p>Ready to implement user account verification in your application? Here&#39;s how it works at a high level:</p>
<ol>
<li><p>The user begins the registration process by entering their data, including a phone number, into a signup form</p>
</li>
<li><p>The authentication system sends a one-time password to the user&#39;s mobile phone to verify their possession of that phone number</p>
</li>
<li><p>The user enters the one-time password into a form before completing registration</p>
</li>
<li><p>The user sees a success page and receives an SMS indicating that their account has been created</p>
</li>
</ol>
</div><div data-title="Bulding Blocks" class="step"><h2 id="building-blocks">Building Blocks</h2>
<p>To get this done, you&#39;ll be working with the following Twilio-powered APIs:</p>
<p><strong>Authy REST API</strong></p>
<ul>
<li><a href="//docs.authy.com/#section-Enabling_two-factor_on_a_user">Users Resource</a>: You will need to create Authy users to send and verify one-time passwords with them.</li>
<li><a href="//docs.authy.com/#section-Text_Messages">SMS Resource</a>: We will ask Authy to send one-time passwords to our user via SMS</li>
<li><a href="//docs.authy.com/#section-Verifying_a_token">Verify Resource</a>: Used to verify tokens entered by the user in our web form during registration</li>
</ul>
<p><strong>Twilio REST API</strong></p>
<ul>
<li><a href="/docs/api/rest/sending-sms">Messages Resource</a>: We will use Twilio directly to send our user a confirmation message after they create an account</li>
</ul>
<p>Let&#39;s get started! Click the right arrow to move on to the next step of the tutorial.</p>
</div><div data-title="Registering a User Account" data-file="models/User.js" data-highlight="12-40" class="step"><h2 id="the-user-model">The User Model</h2>
<p>Our first order of business is to create a model object for a user of our application. We will borrow a lot of the code from the <code>User</code> model in the <a href="/docs/howto/walkthrough/two-factor-authentication/node/express">2FA tutorial</a> that uses Authy as well. This application uses <a href="http://www.mongodb.com/">MongoDB</a> for persistence, but in our code we will primarily interface with <a href="http://mongoosejs.com/">Mongoose</a>, a higher-level object modeling tool which is backed by MongoDB.</p>
<p>You&#39;ll notice an <code>authyId</code> property on the model - <a href="//docs.authy.com/#section-Enabling_two-factor_on_a_user">this is required to support integration with the Authy API</a>. We won&#39;t use this property right away, but we&#39;ll need it later for the Authy integration.</p>
<p>One of the properties on the <code>User</code> model, per the user story, is a password (we&#39;ll probably want that later to log a user in, even though it&#39;s not in scope for this tutorial).</p>
</div><div data-title="The Form Template" data-file="views/users/create.jade" data-language="jade" class="step"><h2 id="the-form-template">The Form Template</h2>
<p>When we create a new user, we ask for a name, e-mail address, and a password. 
In order to validate their account we also ask them for a mobile number with a country code. 
We use Authy to send them a one-time password via SMS to this phone number.</p>
<p>Now the user is logged in but not verified. In the next steps we&#39;ll learn how to verify the user using Authy.</p>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//jade-lang.com/">Jade</a></li>
</ul>
</div><div data-title="Configuring Authy" data-file="config.js" data-highlight="24-26" class="step"><h2 id="configuring-authy">Configuring Authy</h2>
<p>In <code>config.js</code>, we list configuration parameters for the application. Most are pulled in from system environment variables, which is a helpful way to access sensitive values (like API keys). This prevents us from accidentally checking them in to source control.</p>
<p>Now, we need our Authy production key (<a href="//dashboard.authy.com/signup">sign up for Authy here</a>). When you create an Authy application, the production key is found on the dashboard:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-authy-dashboard.png" alt="Authy Dashboard"></p>
<p>Next, we need to jump over to the <code>User</code> model to configure the Authy client and create an instance method to send a one-time password.</p>
</div><div data-title="Send a Verification Token" data-file="models/User.js" data-highlight="73-101" class="step"><h2 id="send-a-verification-token">Send a Verification Token</h2>
<p>When it comes time to actually send the user a verification code, we do that in our model function here.</p>
<p>Before sending the code, an <a href="//docs.authy.com/#section-Enabling_two-factor_on_a_user">Authy user</a> needs to exist as a pair for our <code>User</code> model in the database.  If the <code>authyId</code> for our user instance hasn&#39;t been set, we use the Authy API client to create an associated Authy user and store that ID in our database.</p>
<p>Once the user has an <code>authyId</code>, we can actually send a verification code to that user&#39;s mobile phone.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//github.com/authy/node-authy">Node Client for Authy API</a></li>
</ul>
</div><div data-title="Verifying the Code: Controller" data-file="controllers/users.js" data-highlight="95-147" class="step"><h2 id="verifying-the-code-controller">Verifying the Code: Controller</h2>
<p>This controller function handles the form submission. It&#39;s a little longer than the others, but it has a lot to do. It needs to:</p>
<ul>
<li>Load a <code>User</code> model for the current verification request</li>
<li>Use an instance function on the model object to verify the code that was entered by the user</li>
<li>If the code entered was valid, flip a boolean flag on the user model to indicate the account was verified</li>
</ul>
<p>Let&#39;s look at the <code>User</code> model to check out the instance method that handles verifying the code with Authy next.</p>
</div><div data-title="Verifying the Code: Model" data-file="models/User.js" data-highlight="103-109" class="step"><h2 id="verifying-the-code-model">Verifying the Code: Model</h2>
<p>This instance function is a thin wrapper around the Authy client function that sends in a candidate password to be verified. 
We call Authy, and then immediately call a passed callback function with the result.</p>
</div><div data-title="Re-sending The Code" data-file="controllers/users.js" data-highlight="65-93" class="step"><h2 id="re-sending-the-code">Re-sending the Code</h2>
<p>This controller function loads the <code>User</code> model associated with the request and then uses the same instance function we defined earlier to resend the code. Pretty straightforward!</p>
<p>To wrap things up, let&#39;s implement the last step where we confirm that the user&#39;s account has
been verified with a text message and a success page.</p>
</div><div data-title="Show User Details Page" data-file="controllers/users.js" data-highlight="149-167" class="step"><h2 id="show-user-details-page">Show User Details Page</h2>
<p>This controller function renders a Jade template that contains the user&#39;s full name, and indicates whether or not they are verified by checking the user&#39;s <code>verified</code> property.</p>
<p>This should suffice for confirmation in the browser that the user has been verified. Let&#39;s see how we might send that text message next.</p>
</div><div data-title="Sending a Message: Using the Twilio Client" data-file="models/User.js" data-highlight="111-121" class="step"><h2 id="sending-a-message">Sending a Message</h2>
<p>Here, we add another instance function to the model that will send a text message to the user&#39;s configured phone number. Rather than just being a one-time password, this can be anything we wish.</p>
<p>Let&#39;s finish up in the controller, where we actually use this functionality.</p>
<p>For more information on how to send SMS using Twilio&#39;s Rest API visit this
<a href="//twilio-php.readthedocs.org/en/latest/usage/rest/messages.html#sending-a-message">link</a>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/rest">Twilio Rest API Documentation</a></li>
<li><a href="//www.twilio.com/docs/api/rest/sending-messages">Sending SMS With the API</a></li>
</ul>
</div><div data-title="Where to Next?" class="step"><h2 id="where-to-next-">Where to Next?</h2>
<p>That&#39;s it!</p>
<p>We&#39;ve just implemented account verification so your users can
confirm their phone number. If you&#39;re a Node developer working with Twilio,
you might want to check out these other tutorials:</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/click-to-call/node/express"><strong>Click-To-Call</strong></a></p>
<p>Put a button on your web page that connects visitors to live support or sales people via telephone.</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/automated-survey/node/express"><strong>Automated Survey</strong></a></p>
<p>Instantly collect structured data from your users with a survey conducted
over a voice call or SMS text messages.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share
with us, we&#39;d love to hear it.
<a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="models/User.js" data-mode="javascript">dmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKdmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpOwp2YXIgY29uZmlnID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7CgovLyBDcmVhdGUgYXV0aGVudGljYXRlZCBBdXRoeSBhbmQgVHdpbGlvIEFQSSBjbGllbnRzCnZhciBhdXRoeSA9IHJlcXVpcmUoJ2F1dGh5JykoY29uZmlnLmF1dGh5S2V5KTsKdmFyIHR3aWxpb0NsaWVudCA9IHJlcXVpcmUoJ3R3aWxpbycpKGNvbmZpZy5hY2NvdW50U2lkLCBjb25maWcuYXV0aFRva2VuKTsKCi8vIFVzZWQgdG8gZ2VuZXJhdGUgcGFzc3dvcmQgaGFzaAp2YXIgU0FMVF9XT1JLX0ZBQ1RPUiA9IDEwOwoKLy8gRGVmaW5lIHVzZXIgbW9kZWwgc2NoZW1hCnZhciBVc2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7CiAgICBmdWxsTmFtZTogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGNvdW50cnlDb2RlOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgcGhvbmU6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICB2ZXJpZmllZDogewogICAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBhdXRoeUlkOiBTdHJpbmcsCiAgICBlbWFpbDogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB1bmlxdWU6IHRydWUKICAgIH0sCiAgICBwYXNzd29yZDogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQp9KTsKCi8vIE1pZGRsZXdhcmUgZXhlY3V0ZWQgYmVmb3JlIHNhdmUgLSBoYXNoIHRoZSB1c2VyJ3MgcGFzc3dvcmQKVXNlclNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLy8gb25seSBoYXNoIHRoZSBwYXNzd29yZCBpZiBpdCBoYXMgYmVlbiBtb2RpZmllZCAob3IgaXMgbmV3KQogICAgaWYgKCFzZWxmLmlzTW9kaWZpZWQoJ3Bhc3N3b3JkJykpIHJldHVybiBuZXh0KCk7CgogICAgLy8gZ2VuZXJhdGUgYSBzYWx0CiAgICBiY3J5cHQuZ2VuU2FsdChTQUxUX1dPUktfRkFDVE9SLCBmdW5jdGlvbihlcnIsIHNhbHQpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpOwoKICAgICAgICAvLyBoYXNoIHRoZSBwYXNzd29yZCB1c2luZyBvdXIgbmV3IHNhbHQKICAgICAgICBiY3J5cHQuaGFzaChzZWxmLnBhc3N3b3JkLCBzYWx0LCBmdW5jdGlvbihlcnIsIGhhc2gpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIG5leHQoZXJyKTsKCiAgICAgICAgICAgIC8vIG92ZXJyaWRlIHRoZSBjbGVhcnRleHQgcGFzc3dvcmQgd2l0aCB0aGUgaGFzaGVkIG9uZQogICAgICAgICAgICBzZWxmLnBhc3N3b3JkID0gaGFzaDsKICAgICAgICAgICAgbmV4dCgpOwogICAgICAgIH0pOwogICAgfSk7Cn0pOwoKLy8gVGVzdCBjYW5kaWRhdGUgcGFzc3dvcmQKVXNlclNjaGVtYS5tZXRob2RzLmNvbXBhcmVQYXNzd29yZCA9IGZ1bmN0aW9uKGNhbmRpZGF0ZVBhc3N3b3JkLCBjYikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgYmNyeXB0LmNvbXBhcmUoY2FuZGlkYXRlUGFzc3dvcmQsIHNlbGYucGFzc3dvcmQsIGZ1bmN0aW9uKGVyciwgaXNNYXRjaCkgewogICAgICAgIGlmIChlcnIpIHJldHVybiBjYihlcnIpOwogICAgICAgIGNiKG51bGwsIGlzTWF0Y2gpOwogICAgfSk7Cn07CgovLyBTZW5kIGEgdmVyaWZpY2F0aW9uIHRva2VuIHRvIHRoaXMgdXNlcgpVc2VyU2NoZW1hLm1ldGhvZHMuc2VuZEF1dGh5VG9rZW4gPSBmdW5jdGlvbihjYikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGlmICghc2VsZi5hdXRoeUlkKSB7CiAgICAgICAgLy8gUmVnaXN0ZXIgdGhpcyB1c2VyIGlmIGl0J3MgYSBuZXcgdXNlcgogICAgICAgIGF1dGh5LnJlZ2lzdGVyX3VzZXIoc2VsZi5lbWFpbCwgc2VsZi5waG9uZSwgc2VsZi5jb3VudHJ5Q29kZSwgCiAgICAgICAgICAgIGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZXJyIHx8ICFyZXNwb25zZS51c2VyKSByZXR1cm4gY2IuY2FsbChzZWxmLCBlcnIpOwogICAgICAgICAgICBzZWxmLmF1dGh5SWQgPSByZXNwb25zZS51c2VyLmlkOwogICAgICAgICAgICBzZWxmLnNhdmUoZnVuY3Rpb24oZXJyLCBkb2MpIHsKICAgICAgICAgICAgICAgIGlmIChlcnIgfHwgIWRvYykgcmV0dXJuIGNiLmNhbGwoc2VsZiwgZXJyKTsKICAgICAgICAgICAgICAgIHNlbGYgPSBkb2M7CiAgICAgICAgICAgICAgICBzZW5kVG9rZW4oKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIE90aGVyd2lzZSBzZW5kIHRva2VuIHRvIGEga25vd24gdXNlcgogICAgICAgIHNlbmRUb2tlbigpOwogICAgfQoKICAgIC8vIFdpdGggYSB2YWxpZCBBdXRoeSBJRCwgc2VuZCB0aGUgMkZBIHRva2VuIGZvciB0aGlzIHVzZXIKICAgIGZ1bmN0aW9uIHNlbmRUb2tlbigpIHsKICAgICAgICBhdXRoeS5yZXF1ZXN0X3NtcyhzZWxmLmF1dGh5SWQsIHRydWUsIGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UpIHsKICAgICAgICAgICAgY2IuY2FsbChzZWxmLCBlcnIpOwogICAgICAgIH0pOwogICAgfQp9OwoKLy8gVGVzdCBhIDJGQSB0b2tlbgpVc2VyU2NoZW1hLm1ldGhvZHMudmVyaWZ5QXV0aHlUb2tlbiA9IGZ1bmN0aW9uKG90cCwgY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGF1dGh5LnZlcmlmeShzZWxmLmF1dGh5SWQsIG90cCwgZnVuY3Rpb24oZXJyLCByZXNwb25zZSkgewogICAgICAgIGNiLmNhbGwoc2VsZiwgZXJyLCByZXNwb25zZSk7CiAgICB9KTsKfTsKCi8vIFNlbmQgYSB0ZXh0IG1lc3NhZ2UgdmlhIHR3aWxpbyB0byB0aGlzIHVzZXIKVXNlclNjaGVtYS5tZXRob2RzLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHR3aWxpb0NsaWVudC5zZW5kTWVzc2FnZSh7CiAgICAgICAgdG86IHNlbGYuY291bnRyeUNvZGUrc2VsZi5waG9uZSwKICAgICAgICBmcm9tOiBjb25maWcudHdpbGlvTnVtYmVyLAogICAgICAgIGJvZHk6IG1lc3NhZ2UKICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UpIHsKICAgICAgICBjYi5jYWxsKHNlbGYsIGVycik7CiAgICB9KTsKfTsKCi8vIEV4cG9ydCB1c2VyIG1vZGVsCm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1VzZXInLCBVc2VyU2NoZW1hKTs=</textarea>
<textarea class="saurus-file" data-file="views/users/create.jade" data-mode="jade">ZXh0ZW5kcyAuLi9sYXlvdXQKCmJsb2NrIHN0eWxlcwogIGxpbmsocmVsPSdzdHlsZXNoZWV0JywgbWVkaWE9J3NjcmVlbicKICAgIGhyZWY9Jy8vd3d3LmF1dGh5LmNvbS9mb3JtLmF1dGh5Lm1pbi5jc3MnKQoKYmxvY2sgY29udGVudAogIGgxIFdlJ3JlIEdvaW5nIFRvIEJlICpCRVNUKiBGcmllbmRzCiAgcC4KICAgIFRoYW5rIHlvdSBmb3IgeW91ciBpbnRlcmVzdCBpbiBzaWduaW5nIHVwISBDYW4geW91IHRlbGwgdXMgYSBiaXQgYWJvdXQgCiAgICB5b3Vyc2VsZj8KCiAgZm9ybShhY3Rpb249Jy91c2VycycsIG1ldGhvZD0nUE9TVCcpCiAgICAuZm9ybS1ncm91cAogICAgICBsYWJlbChmb3I9J2Z1bGxOYW1lJykgWW91ciBGdWxsIE5hbWU6CiAgICAgIGlucHV0LmZvcm0tY29udHJvbCh0eXBlPSd0ZXh0JywgbmFtZT0nZnVsbE5hbWUnLCAKICAgICAgICBwbGFjZWhvbGRlcj0nUGVnZ3kgQ2FydGVyJykKCiAgICAuZm9ybS1ncm91cAogICAgICBsYWJlbChmb3I9J2VtYWlsJykgWW91ciBFLU1haWwgQWRkcmVzczoKICAgICAgaW5wdXQuZm9ybS1jb250cm9sKHR5cGU9J2VtYWlsJywgbmFtZT0nZW1haWwnLCAKICAgICAgICBwbGFjZWhvbGRlcj0ncGNhcnRlckBzc3IuZ292JykKCiAgICAuZm9ybS1ncm91cAogICAgICBsYWJlbChmb3I9J3Bhc3N3b3JkJykgWW91ciBQYXNzd29yZDoKICAgICAgaW5wdXQuZm9ybS1jb250cm9sKHR5cGU9J3Bhc3N3b3JkJywgbmFtZT0ncGFzc3dvcmQnKQoKICAgIC5mb3JtLWdyb3VwCiAgICAgIGxhYmVsKGZvcj0nY291bnRyeUNvZGUnKSBDb3VudHJ5IENvZGU6CiAgICAgIHNlbGVjdChpZD0nYXV0aHktY291bnRyaWVzJywgbmFtZT0nY291bnRyeUNvZGUnKQoKICAgIC5mb3JtLWdyb3VwCiAgICAgIGxhYmVsKGZvcj0ncGhvbmUnKSBNb2JpbGUgUGhvbmU6CiAgICAgIGlucHV0LmZvcm0tY29udHJvbCh0eXBlPSd0ZXh0JywgbmFtZT0ncGhvbmUnLCBwbGFjZWhvbGRlcj0nNjUxLTg2Ny01MzA5JykKCiAgICBidXR0b24uYnRuLmJ0bi1wcmltYXJ5KHR5cGU9J3N1Ym1pdCcpIENyZWF0ZSBBY2NvdW50CgpibG9jayBzY3JpcHRzCiAgLy8gSW5jbHVkZSBBdXRoeSBmb3JtIGhlbHBlcnMgYW5kIGFkZGl0aW9uYWwgaGVscGVyIHNjcmlwdAogIHNjcmlwdChzcmM9Jy8vd3d3LmF1dGh5LmNvbS9mb3JtLmF1dGh5Lm1pbi5qcycpCiAgc2NyaXB0KHNyYz0nL2pzL2NyZWF0ZV9mb3JtLmpzJyk=</textarea>
<textarea class="saurus-file" data-file="config.js" data-mode="javascript">dmFyIGNmZyA9IHt9OwoKLy8gSFRUUCBQb3J0IHRvIHJ1biBvdXIgd2ViIGFwcGxpY2F0aW9uCmNmZy5wb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCAzMDAwOwoKLy8gQSByYW5kb20gc3RyaW5nIHRoYXQgd2lsbCBoZWxwIGdlbmVyYXRlIHNlY3VyZSBvbmUtdGltZSBwYXNzd29yZHMgYW5kCi8vIEhUVFAgc2Vzc2lvbnMKY2ZnLnNlY3JldCA9IHByb2Nlc3MuZW52LkFQUF9TRUNSRVQgfHwgJ2tleWJvYXJkIGNhdCc7CgovLyBZb3VyIFR3aWxpbyBhY2NvdW50IFNJRCBhbmQgYXV0aCB0b2tlbiwgYm90aCBmb3VuZCBhdDoKLy8gaHR0cHM6Ly93d3cudHdpbGlvLmNvbS91c2VyL2FjY291bnQKLy8gCi8vIEEgZ29vZCBwcmFjdGljZSBpcyB0byBzdG9yZSB0aGVzZSBzdHJpbmcgdmFsdWVzIGFzIHN5c3RlbSBlbnZpcm9ubWVudAovLyB2YXJpYWJsZXMsIGFuZCBsb2FkIHRoZW0gZnJvbSB0aGVyZSBhcyB3ZSBhcmUgZG9pbmcgYmVsb3cuIEFsdGVybmF0ZWx5LAovLyB5b3UgY291bGQgaGFyZCBjb2RlIHRoZXNlIHZhbHVlcyBoZXJlIGFzIHN0cmluZ3MuCmNmZy5hY2NvdW50U2lkID0gcHJvY2Vzcy5lbnYuVFdJTElPX0FDQ09VTlRfU0lEOwpjZmcuYXV0aFRva2VuID0gcHJvY2Vzcy5lbnYuVFdJTElPX0FVVEhfVE9LRU47CgovLyBBIFR3aWxpbyBudW1iZXIgeW91IGNvbnRyb2wgLSBjaG9vc2Ugb25lIGZyb206Ci8vIGh0dHBzOi8vd3d3LnR3aWxpby5jb20vdXNlci9hY2NvdW50L3Bob25lLW51bWJlcnMvaW5jb21pbmcKLy8gU3BlY2lmeSBpbiBFLjE2NCBmb3JtYXQsIGUuZy4gIisxNjUxOTk5ODg3NyIKY2ZnLnR3aWxpb051bWJlciA9IHByb2Nlc3MuZW52LlRXSUxJT19OVU1CRVI7CgovLyBZb3VyIEF1dGh5IHByb2R1Y3Rpb24ga2V5IC0gdGhpcyBjYW4gYmUgZm91bmQgb24gdGhlIGRhc2hib2FyZCBmb3IgeW91ciAKLy8gQXV0aHkgYXBwbGljYXRpb24KY2ZnLmF1dGh5S2V5ID0gcHJvY2Vzcy5lbnYuQVVUSFlfQVBJX0tFWTsKCi8vIE1vbmdvREIgY29ubmVjdGlvbiBzdHJpbmcgLSBNT05HT19VUkwgaXMgZm9yIGxvY2FsIGRldiwKLy8gTU9OR09MQUJfVVJJIGlzIGZvciB0aGUgTW9uZ29MYWIgYWRkLW9uIGZvciBIZXJva3UgZGVwbG95bWVudApjZmcubW9uZ29VcmwgPSBwcm9jZXNzLmVudi5NT05HT0xBQl9VUkkgfHwgcHJvY2Vzcy5lbnYuTU9OR09fVVJMOwoKLy8gRXhwb3J0IGNvbmZpZ3VyYXRpb24gb2JqZWN0Cm1vZHVsZS5leHBvcnRzID0gY2ZnOw==</textarea>
<textarea class="saurus-file" data-file="controllers/users.js" data-mode="javascript">dmFyIFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpOwoKLy8gRGlzcGxheSBhIGZvcm0gdGhhdCBhbGxvd3MgdXNlcnMgdG8gc2lnbiB1cCBmb3IgYSBuZXcgYWNjb3VudApleHBvcnRzLnNob3dDcmVhdGUgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgcmVzcG9uc2UucmVuZGVyKCd1c2Vycy9jcmVhdGUnLCB7CiAgICAgICAgdGl0bGU6ICdDcmVhdGUgVXNlciBBY2NvdW50JywKICAgICAgICAvLyBpbmNsdWRlIGFueSBlcnJvcnMgKHN1Y2Nlc3MgbWVzc2FnZXMgbm90IHBvc3NpYmxlIGZvciB2aWV3KQogICAgICAgIGVycm9yczogcmVxdWVzdC5mbGFzaCgnZXJyb3JzJykKICAgIH0pOwp9OwoKLy8gY3JlYXRlIGEgbmV3IHVzZXIgYmFzZWQgb24gdGhlIGZvcm0gc3VibWlzc2lvbgpleHBvcnRzLmNyZWF0ZSA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICB2YXIgcGFyYW1zID0gcmVxdWVzdC5ib2R5OwogICAgCiAgICAvLyBDcmVhdGUgYSBuZXcgdXNlciBiYXNlZCBvbiBmb3JtIHBhcmFtZXRlcnMKICAgIHZhciB1c2VyID0gbmV3IFVzZXIoewogICAgICAgIGZ1bGxOYW1lOiBwYXJhbXMuZnVsbE5hbWUsCiAgICAgICAgZW1haWw6IHBhcmFtcy5lbWFpbCwKICAgICAgICBwaG9uZTogcGFyYW1zLnBob25lLAogICAgICAgIGNvdW50cnlDb2RlOiBwYXJhbXMuY291bnRyeUNvZGUsCiAgICAgICAgcGFzc3dvcmQ6IHBhcmFtcy5wYXNzd29yZAogICAgfSk7CgogICAgdXNlci5zYXZlKGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAvLyBUbyBpbXByb3ZlIG9uIHRoaXMgZXhhbXBsZSwgeW91IHNob3VsZCBpbmNsdWRlIGEgYmV0dGVyCiAgICAgICAgICAgIC8vIGVycm9yIG1lc3NhZ2UsIGVzcGVjaWFsbHkgYXJvdW5kIGZvcm0gZmllbGQgdmFsaWRhdGlvbi4gQnV0CiAgICAgICAgICAgIC8vIGZvciBub3csIGp1c3QgaW5kaWNhdGUgdGhhdCB0aGUgc2F2ZSBvcGVyYXRpb24gZmFpbGVkCiAgICAgICAgICAgIHJlcXVlc3QuZmxhc2goJ2Vycm9ycycsICdUaGVyZSB3YXMgYSBwcm9ibGVtIGNyZWF0aW5nIHlvdXInCiAgICAgICAgICAgICAgICArICcgYWNjb3VudCAtIG5vdGUgdGhhdCBhbGwgZmllbGRzIGFyZSByZXF1aXJlZC4gUGxlYXNlJwogICAgICAgICAgICAgICAgKyAnIGRvdWJsZS1jaGVjayB5b3VyIGlucHV0IGFuZCB0cnkgYWdhaW4uJyk7CgogICAgICAgICAgICByZXNwb25zZS5yZWRpcmVjdCgnL3VzZXJzL25ldycpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJZiB0aGUgdXNlciBpcyBjcmVhdGVkIHN1Y2Nlc3NmdWxseSwgc2VuZCB0aGVtIGFuIGFjY291bnQKICAgICAgICAgICAgLy8gdmVyaWZpY2F0aW9uIHRva2VuCiAgICAgICAgICAgIHVzZXIuc2VuZEF1dGh5VG9rZW4oZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5mbGFzaCgnZXJyb3JzJywgJ1RoZXJlIHdhcyBhIHByb2JsZW0gc2VuZGluZyAnCiAgICAgICAgICAgICAgICAgICAgICAgICsgJ3lvdXIgdG9rZW4gLSBzb3JyeSA6KCcpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFNlbmQgdG8gdG9rZW4gdmVyaWZpY2F0aW9uIHBhZ2UKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlZGlyZWN0KCcvdXNlcnMvJytkb2MuX2lkKycvdmVyaWZ5Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwp9OwoKLy8gRGlzcGxheSBhIGZvcm0gdGhhdCBhbGxvd3MgdXNlcnMgdG8gZW50ZXIgYSB2ZXJpZmljYXRpb24gdG9rZW4KZXhwb3J0cy5zaG93VmVyaWZ5ID0gZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIHJlc3BvbnNlLnJlbmRlcigndXNlcnMvdmVyaWZ5JywgewogICAgICAgIHRpdGxlOiAnVmVyaWZ5IFBob25lIE51bWJlcicsCiAgICAgICAgLy8gaW5jbHVkZSBhbnkgZXJyb3JzCiAgICAgICAgZXJyb3JzOiByZXF1ZXN0LmZsYXNoKCdlcnJvcnMnKSwKICAgICAgICAvLyBzdWNjZXNzIG1lc3NzYWdlcwogICAgICAgIHN1Y2Nlc3NlczogcmVxdWVzdC5mbGFzaCgnc3VjY2Vzc2VzJyksCiAgICAgICAgLy8gSW5jbHVkZSBkYXRhYmFzZSBJRCB0byBpbmNsdWRlIGluIGZvcm0gUE9TVCBhY3Rpb24KICAgICAgICBpZDogcmVxdWVzdC5wYXJhbXMuaWQKICAgIH0pOwp9OwoKLy8gUmVzZW5kIGEgY29kZSBpZiBpdCB3YXMgbm90IHJlY2VpdmVkCmV4cG9ydHMucmVzZW5kID0gZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIC8vIExvYWQgdXNlciBtb2RlbAogICAgVXNlci5maW5kQnlJZChyZXF1ZXN0LnBhcmFtcy5pZCwgZnVuY3Rpb24oZXJyLCB1c2VyKSB7CiAgICAgICAgaWYgKGVyciB8fCAhdXNlcikgewogICAgICAgICAgICByZXR1cm4gZGllKCdVc2VyIG5vdCBmb3VuZCBmb3IgdGhpcyBJRC4nKTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHdlIGZpbmQgdGhlIHVzZXIsIGxldCdzIHNlbmQgdGhlbSBhIG5ldyBjb2RlCiAgICAgICAgdXNlci5zZW5kQXV0aHlUb2tlbihwb3N0U2VuZCk7CiAgICB9KTsKCiAgICAvLyBIYW5kbGUgc2VuZCBjb2RlIHJlc3BvbnNlCiAgICBmdW5jdGlvbiBwb3N0U2VuZChlcnIpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBkaWUoJ1RoZXJlIHdhcyBhIHByb2JsZW0gc2VuZGluZyB5b3UgdGhlIGNvZGUgLSBwbGVhc2UgJwogICAgICAgICAgICAgICAgKyAncmV0cnkuJyk7CiAgICAgICAgfQoKICAgICAgICByZXF1ZXN0LmZsYXNoKCdzdWNjZXNzZXMnLCAnQ29kZSByZS1zZW50IScpOwogICAgICAgIHJlc3BvbnNlLnJlZGlyZWN0KCcvdXNlcnMvJytyZXF1ZXN0LnBhcmFtcy5pZCsnL3ZlcmlmeScpOwogICAgfQoKICAgIC8vIHJlc3BvbmQgd2l0aCBhbiBlcnJvcgogICAgZnVuY3Rpb24gZGllKG1lc3NhZ2UpIHsKICAgICAgICByZXF1ZXN0LmZsYXNoKCdlcnJvcnMnLCBtZXNzYWdlKTsKICAgICAgICByZXNwb25zZS5yZWRpcmVjdCgnL3VzZXJzLycrcmVxdWVzdC5wYXJhbXMuaWQrJy92ZXJpZnknKTsKICAgIH0KfTsKCi8vIEhhbmRsZSBzdWJtaXNzaW9uIG9mIHZlcmlmaWNhdGlvbiB0b2tlbgpleHBvcnRzLnZlcmlmeSA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICB2YXIgdXNlcjsKCiAgICAvLyBMb2FkIHVzZXIgbW9kZWwKICAgIFVzZXIuZmluZEJ5SWQocmVxdWVzdC5wYXJhbXMuaWQsIGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZG9jKSB7CiAgICAgICAgICAgIHJldHVybiBkaWUoJ1VzZXIgbm90IGZvdW5kIGZvciB0aGlzIElELicpOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgd2UgZmluZCB0aGUgdXNlciwgbGV0J3MgdmFsaWRhdGUgdGhlIHRva2VuIHRoZXkgZW50ZXJlZAogICAgICAgIHVzZXIgPSBkb2M7CiAgICAgICAgdXNlci52ZXJpZnlBdXRoeVRva2VuKHJlcXVlc3QuYm9keS5jb2RlLCBwb3N0VmVyaWZ5KTsKICAgIH0pOwoKICAgIC8vIEhhbmRsZSB2ZXJpZmljYXRpb24gcmVzcG9uc2UKICAgIGZ1bmN0aW9uIHBvc3RWZXJpZnkoZXJyKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICByZXR1cm4gZGllKCdUaGUgdG9rZW4geW91IGVudGVyZWQgd2FzIGludmFsaWQgLSBwbGVhc2UgcmV0cnkuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGUgdG9rZW4gd2FzIHZhbGlkLCBmbGlwIHRoZSBiaXQgdG8gdmFsaWRhdGUgdGhlIHVzZXIgYWNjb3VudAogICAgICAgIHVzZXIudmVyaWZpZWQgPSB0cnVlOwogICAgICAgIHVzZXIuc2F2ZShwb3N0U2F2ZSk7CiAgICB9CgogICAgLy8gYWZ0ZXIgd2Ugc2F2ZSB0aGUgdXNlciwgaGFuZGxlIHNlbmRpbmcgYSBjb25maXJtYXRpb24KICAgIGZ1bmN0aW9uIHBvc3RTYXZlKGVycikgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGRpZSgnVGhlcmUgd2FzIGEgcHJvYmxlbSB2YWxpZGF0aW5nIHlvdXIgYWNjb3VudCAnCiAgICAgICAgICAgICAgICArICctIHBsZWFzZSBlbnRlciB5b3VyIHRva2VuIGFnYWluLicpOwogICAgICAgIH0KCiAgICAgICAgLy8gU2VuZCBjb25maXJtYXRpb24gdGV4dCBtZXNzYWdlCiAgICAgICAgdmFyIG1lc3NhZ2UgPSAnWW91IGRpZCBpdCEgU2lnbnVwIGNvbXBsZXRlIDopJzsKICAgICAgICB1c2VyLnNlbmRNZXNzYWdlKG1lc3NhZ2UsIGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0LmZsYXNoKCdlcnJvcnMnLCAnWW91IGFyZSBzaWduZWQgdXAsIGJ1dCAnCiAgICAgICAgICAgICAgICAgICAgKyAnd2UgY291bGQgbm90IHNlbmQgeW91IGEgbWVzc2FnZS4gT3VyIGJhZCA6KCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzaG93IHN1Y2Nlc3MgcGFnZQogICAgICAgICAgICByZXF1ZXN0LmZsYXNoKCdzdWNjZXNzZXMnLCBtZXNzYWdlKTsKICAgICAgICAgICAgcmVzcG9uc2UucmVkaXJlY3QoJy91c2Vycy8nK3VzZXIuX2lkKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyByZXNwb25kIHdpdGggYW4gZXJyb3IKICAgIGZ1bmN0aW9uIGRpZShtZXNzYWdlKSB7CiAgICAgICAgcmVxdWVzdC5mbGFzaCgnZXJyb3JzJywgbWVzc2FnZSk7CiAgICAgICAgcmVzcG9uc2UucmVkaXJlY3QoJy91c2Vycy8nK3JlcXVlc3QucGFyYW1zLmlkKycvdmVyaWZ5Jyk7CiAgICB9Cn07CgovLyBTaG93IGRldGFpbHMgYWJvdXQgdGhlIHVzZXIKZXhwb3J0cy5zaG93VXNlciA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0KSB7CiAgICAvLyBMb2FkIHVzZXIgbW9kZWwKICAgIFVzZXIuZmluZEJ5SWQocmVxdWVzdC5wYXJhbXMuaWQsIGZ1bmN0aW9uKGVyciwgdXNlcikgewogICAgICAgIGlmIChlcnIgfHwgIXVzZXIpIHsKICAgICAgICAgICAgLy8gNDA0CiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7CiAgICAgICAgfQoKICAgICAgICByZXNwb25zZS5yZW5kZXIoJ3VzZXJzL3Nob3cnLCB7CiAgICAgICAgICAgIHRpdGxlOiAnSGkgdGhlcmUgJyArIHVzZXIuZnVsbE5hbWUgKyAnIScsCiAgICAgICAgICAgIHVzZXI6IHVzZXIsCiAgICAgICAgICAgIC8vIGFueSBlcnJvcnMKICAgICAgICAgICAgZXJyb3JzOiByZXF1ZXN0LmZsYXNoKCdlcnJvcnMnKSwKICAgICAgICAgICAgLy8gYW55IHN1Y2Nlc3MgbWVzc2FnZXMKICAgICAgICAgICAgc3VjY2Vzc2VzOiByZXF1ZXN0LmZsYXNoKCdzdWNjZXNzZXMnKQogICAgICAgIH0pOwogICAgfSk7Cn07Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/account-verification-node" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>